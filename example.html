<!DOCTYPE html>
<html>
<head>
  <title>Scope3 Segments Example</title>
  <meta name="description" content="Example page showing Scope3 segments integration">
  
  <!-- Include the Scope3 client script -->
  <script src="scope3-client.js"></script>
  
  <!-- Example of using the segments with Prebid.js -->
  <script>
    // Listen for when Scope3 segments are ready
    document.addEventListener('scope3SegmentsReady', function(event) {
      const segments = event.detail.segments;
      console.log('Scope3 segments are ready:', segments);
      
      // Display segments on page (just for demo)
      displaySegments(segments);
      
      // Example: Use segments with Prebid.js
      if (window.pbjs) {
        pbjs.que.push(function() {
          // Set targeting for all bid adapters
          pbjs.setTargetingForGPTAsync({
            'scope3_segments': segments
          });
        });
      }
    });
    
    // Function to display segments on the page
    function displaySegments(segments) {
      const segmentsList = document.getElementById('segments-list');
      if (!segmentsList) return;
      
      segmentsList.innerHTML = '';
      
      if (segments.length === 0) {
        segmentsList.innerHTML = '<li>No segments available</li>';
        return;
      }
      
      segments.forEach(segment => {
        const li = document.createElement('li');
        li.textContent = segment;
        segmentsList.appendChild(li);
      });
    }
  </script>
</head>
<body>
  <h1>Scope3 Segments Integration Example</h1>
  
  <p>This page demonstrates how to integrate with Scope3 segments via a Cloudflare Worker API.</p>
  
  <div class="segments-container">
    <h2>Scope3 Segments</h2>
    <p>The following segments were determined for this page:</p>
    <ul id="segments-list">
      <li>Loading segments...</li>
    </ul>
  </div>
  
  <h2>How It Works</h2>
  <ol>
    <li>When the page loads, the Scope3 client script is executed</li>
    <li>The script sends the current page URL to the Scope3 proxy worker</li>
    <li>The worker fetches the page content (if not cached)</li>
    <li>The worker extracts relevant content and sends it to the Scope3 API</li>
    <li>The worker gets back segments and returns them to the client</li>
    <li>The client script makes segments available as window.scope3_segments</li>
    <li>The client script triggers a "scope3SegmentsReady" event</li>
    <li>Your ad logic can listen for this event and use the segments</li>
  </ol>
  
  <h2>Benefits</h2>
  <ul>
    <li>Fast loading: Uses caching on both server and client side</li>
    <li>Non-blocking: Uses a timeout to avoid slowing down page load</li>
    <li>Easy integration: Just add one script tag to your pages</li>
    <li>Works with any ad server or Prebid.js</li>
  </ul>
</body>
</html>